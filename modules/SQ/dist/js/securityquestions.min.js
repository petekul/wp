var app=angular.module("SSO.sessionIdle",["SSO.url"]);(app=angular.module("SSO.sessionIdle")).directive("sessionIdle",["idleService","urlService",function(e,t){return{templateUrl:"/sso/modules/common/components/session-idle/templates/sessionIdle.tmpl.html",link:function(n,i,o){e.loadConfig(),n.yes=function(){t.loadURLs().then(function(t){e.startTimer()})},n.no=function(){e.logOut()},$("#idleModal").on("hidden.bs.modal",function(t){e.startTimer(),e.hideModal()})}}}]),angular.module("SSO.sessionIdle").service("idleService",["$http","$q","$state","urlService",function(e,t,n,i){var o=0,s=900,a=(t.defer(),function(){$(".modal-backdrop").remove(),$("#idleModal").modal("hide")}),l=function(){clearInterval(o)};return{loadConfig:function(){e.get("/sso/modules/common/components/session-idle/idle.conf.json").then(function(e){s=parseFloat(e.data.timeoutDuration)})},startTimer:function(){var e=(new Date).getTime(),t="0.0";l(),o=setInterval(function(){var n=(new Date).getTime()-e;t=Math.floor(n/100)/10,Math.round(t)==t&&(t+=".0"),t>s-60&&($("#idleModal").is(":hidden")&&$("#idleModal").modal("show"),t>s&&(a(),window.location.href=i.getLogoutURL("statuspage")+"sessiontimeout",l()))},100)},logOut:function(){window.location.href=i.getLogoutURL("statuspage")+"sessiontimeout",l()},timeOut:function(){var e=i.getLogoutURL("statuspage")+"sessiontimeout",t=-1===e.indexOf("?")?"?":"&";window.location.href=e+t+"p_error_code=SSO-1"},hideModal:a}}]),angular.module("SSO.securityquestions").factory("SQService",["$http","$q","urlService",function(e,t,n){var i=$(".scm").attr("class").split(" ")[1];return{getSecurityQuestions:function(t,o){return e.get(n.getURL(i+"SQ"),{headers:{directive:t,backUrl:o}})},loadSQConfig:function(){return e.get(n.getURL("SQconfig"))},postAnswers:function(t,o){return e.post(n.getURL(i+"SQpost"),t,{headers:{"X-CSRF-CUSTOM-TOKEN":"SomeRandomValue",backUrl:o}})},mockPostAnswers:function(t){return e.post("views/security-questions/configs/postSQAPIresponse.json")}}}]),(app=angular.module("SSO.securityquestions")).controller("SQController",["$scope","$stateParams","$state","SQService","urlService","idleService",function(e,t,n,i,o,s){e.questions=[],e.userEmail="someemail";function a(t){for(var n=1;n<=e.originalQuestions.length;n++){var i="#txtAnswer"+n,o="#pIncorrect"+n;if($(i).attr("class").includes(t)){$(i).val(""),$(i).css("border-color","red"),$(o).css("display","block");break}}}function l(e,t){$(t).css("display","none"),$(e).css("border-color","#ccc")}function r(){for(var t=!1,n=!0,i=1;i<=e.questions.length;i++){var o="#txtAnswer"+i;t=n=!($(o).attr("class").includes("LASTNAME")&&$(o).val().length>e.contactConfig.minFieldLength&&!t)&&(!($(o).attr("class").includes("POSTCODE")&&$(o).val().length>=e.postcodeConfig.minFieldLength&&!t)&&!($(o).val().length>=e.midConfig.minFieldLength&&!t))}n?$("#btnSubmitSQ").prop("disabled",!0):$("#btnSubmitSQ").attr("disabled",!1)}function c(){$(".content").css("display","block"),$(".loadingAnimation").css("display","none")}i.getSecurityQuestions({},o.getBackURL()).then(function(t){s.startTimer(),e.userEmail=t.data.userName,e.questions=t.data.securityQuestions,e.originalQuestions=jQuery.extend(!0,[],e.questions),0==e.questions.length||"NOSQ"===e.questions.directive?window.location.href=t.data.nextLink:c()},function(e){window.location.href=o.getLogoutURL("statuspage")+"noSQinfo"}),i.loadSQConfig().then(function(t){s.startTimer();var n=t.data;e.midConfig=n[n.map(e=>e.questionType).indexOf("MID")],e.postcodeConfig=n[n.map(e=>e.questionType).indexOf("POSTCODE")],e.contactConfig=n[n.map(e=>e.questionType).indexOf("LASTNAME")]}),e.onKeyUp=function(t){txtElem="#txtAnswer"+t,incElem="#pIncorrect"+t,$(txtElem).attr("class").includes("MID")&&$(txtElem).val().length>=e.midConfig.minFieldLength?l(txtElem,incElem):$(txtElem).attr("class").includes("POSTCODE")&&$(txtElem).val().length>=e.postcodeConfig.minFieldLength?l(txtElem,incElem):$(txtElem).attr("class").includes("LASTNAME")&&$(txtElem).val().length>e.contactConfig.minFieldLength&&l(txtElem,incElem),"POSTCODE"!=this.questions[t-1].questionType&&"LASTNAME"!=this.questions[t-1].questionType||$(txtElem).val($(txtElem).val().toUpperCase()),r()},e.validateInput=function(t,n){var i=new RegExp;switch(t){case"MID":i=new RegExp(e.midConfig.validRegex);break;case"POSTCODE":i=new RegExp(e.postcodeConfig.validRegex);break;case"LASTNAME":i=new RegExp(e.contactConfig.validRegex)}var o=n||window.event,s=o.keyCode||o.which;8!=s&&(s=String.fromCharCode(s),i.test(s)||(o.returnValue=!1,o.preventDefault&&o.preventDefault()))},e.expand=function(e){e="#"+e,"none"==$(e).css("display")?$(e).css("display","block"):$(e).css("display","none")},e.expandHint=function(t){e.expand(t),iconhintindex="#icon"+t,$(iconhintindex).find("i").toggleClass("glyphicon-question-sign").toggleClass("glyphicon-minus-sign")},e.reloadSQ=function(t){e.questions=t},e.submitForm=function(){var t={};this.questions=jQuery.extend(!0,[],this.originalQuestions);for(var n=0;n<this.originalQuestions.length;n++)ansElem="#txtAnswer"+(n+1),this.questions[n].answer+=$(ansElem).val();$(".content").css("display","none"),$(".loadingAnimation").css("display","block"),t.securityQuestions=this.questions,i.postAnswers(t,o.getBackURL()).then(function(e){if(s.startTimer(),1!=e.data.disabled){if(!(e.data.securityQuestions.length>0))return!0,void(window.location.href=e.data.nextLink);this.reloadSQ(e.data.securityQuestions),!1;for(var t=0;t<this.questions.length;t++)switch(this.questions[t].questionType){case"MID":a("MID");break;case"POSTCODE":a("POSTCODE");break;case"LASTNAME":a("LASTNAME");break;default:console.log("no further questions found")}r(),c()}else window.location.href=o.getLogoutURL("statuspage")+"accountdisabled"}.bind(e),function(e){s.startTimer(),!1,window.location.href=o.getLogoutURL("statuspage")+e.status})},document.addEventListener("invalid",function(e){e.preventDefault()},!0)}]);