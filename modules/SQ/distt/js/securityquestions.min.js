"use strict";angular.module("SSO.securityquestions",["ui.router","SSO.url","SSO.sessionIdle"]).config(["$stateProvider","$urlRouterProvider",function(t,e){t.state("app",{url:"/",views:{header:{templateUrl:"views/header.html"},content:{templateUrl:"views/security-questions/securityquestions.html"},footer:{templateUrl:"views/footer.html"}},onEnter:function(t){t.document.title="For your security | Worldpay Account"}}).state("app.accountdisabled",{views:{"content@":{templateUrl:"views/account-disabled/accountdisabled.html"}},onEnter:function(t){t.document.title="Account disabled | Worldpay Account"}}).state("app.error",{views:{"content@":{templateUrl:"views/error-pages/errorpage.html"}},params:{errormsg:""},onEnter:function(t){t.document.title="Error | Worldpay Account"}}),e.otherwise(function(t,e){t.invoke(["$state",function(t){t.go("app")}])})}]);var app=angular.module("SSO.url",["ui.router"]);angular.module("SSO.url").service("originService",function(t,e){var n,o;e.defer();return{storeOrigin:function(){n=document.URL;var t=function(){var t={};n.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,o){t[n]=o});return t}().backUrl;t||(t="http://www.mybusiness.worldpay.com"),o=t,console.log(o+" has been stored")},getOrigin:function(){return n},getURL:function(){return o}}});(app=angular.module("SSO.url")).controller("urlController",["$scope","$stateParams","$state","urlService",function(t,e,n,o){o.loadURLs().then(function(e){t.logoutURL="/logout?end_url="+o.getDefaultURL()},function(t){void 0==t.status?window.location.href=o.getLogoutURL("statuspage")+"?status_code="+t.status:window.location.href=o.getLogoutURL("statuspage")+"?status_code="+t.message});var s=document.URL;""==s&&(s="http://ukdc2-tc-g1wxs08.wpds.worldpaytd.local:7777/sso/index.html?backUrl=http%3A%2F%2Fmybusiness.wpds.worldpaytd.local%3A7778%2Fmbd.html"),o.storeOrigin(s)}]),angular.module("SSO.url").service("urlService",["$http","$q",function(t,e){var n,o,s=e.defer(),i={};return{loadURLs:function(){var n=t.get("/sso/modules/common/index/config/environment.json"),o=t.get("/sso/modules/common/index/config/urls.json");return e.all([n,o]).then(function(t){t[0].data[0].url,i=t[1].data,s.resolve()}),s.promise},getURLs:function(){return i},getURL:function(t){t.includes("config")||(t+="test");return i.filter(function(e){return e.urlName===t})[0].url},getDefaultURL:function(){return i[0].url},getLogoutURL:function(t){var e=i.filter(function(e){return e.urlName===t});return e[0].url},storeOrigin:function(t){n=t;var e=function(){var t={};n.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,o){t[n]=o});return t}().backUrl;o=decodeURIComponent(e)},getOrigin:function(){return n},getBackURL:function(){return o}}}]);app=angular.module("SSO.analytics",[]);angular.module("SSO.analytics").factory("analyticsService",["analyticsConfigService","$location","$http","$timeout",function(t,e,n,o){var s=angular.noop,i=[],a=!0;t.loadAnalyticsConfig().then(function(t){!function(t){e=window,n=document,o=void 0,s=void 0,e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=n.createElement("script"),s=n.getElementsByTagName("script")[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",s.parentNode.insertBefore(o,s);var e,n,o,s;ga("create",t,"none")}(t.data.googleAnalyticsID)},function(t){}),s=function(t,n){var s=e.path();angular.isDefined(t)&&(s.length>0&&"/"!==s[s.length-1]&&(s+="/"),s+=t),i.indexOf(s)>-1||o(function(){r(n,"googleAnalytics")&&ga("send","pageview",{page:s}),r(n,"f24")&&(a?a=!1:t||"function"==typeof f24_trackPage&&f24_trackPage(encodeURIComponent(document.location)))},200,!1)};var r=function(t,e){return!t||t&&t[e]};return{track:s,enableAll:function(){i=[]},disable:function(t){i.push(t)}}}]),angular.module("SSO.analytics").service("analyticsConfigService",function(t,e){return{loadAnalyticsConfig:function(){return t.get("views/assets/analytics/config/config.json")}}});app=angular.module("SSO.sessionIdle",["SSO.url"]);(app=angular.module("SSO.sessionIdle")).directive("sessionIdle",["idleService","urlService",function(t,e){return{templateUrl:"/sso/modules/common/components/session-idle/templates/sessionIdle.tmpl.html",link:function(n,o,s){t.loadConfig(),n.yes=function(){e.loadURLs().then(function(e){t.startTimer()})},n.no=function(){t.logOut()},$("#idleModal").on("hidden.bs.modal",function(e){t.startTimer(),t.hideModal()})}}}]),angular.module("SSO.sessionIdle").service("idleService",["$http","$q","$state","urlService",function(t,e,n,o){var s=0,i=900,a=(e.defer(),function(){$(".modal-backdrop").remove(),$("#idleModal").modal("hide")}),r=function(){clearInterval(s)};return{loadConfig:function(){t.get("/sso/modules/common/components/session-idle/idle.conf.json").then(function(t){i=parseFloat(t.data.timeoutDuration)})},startTimer:function(){var t=(new Date).getTime(),e="0.0";r(),s=setInterval(function(){var n=(new Date).getTime()-t;e=Math.floor(n/100)/10,Math.round(e)==e&&(e+=".0"),e>i-60&&($("#idleModal").is(":hidden")&&$("#idleModal").modal("show"),e>i&&(a(),window.location.href=o.getLogoutURL("statuspage")+"sessiontimeout",r()))},100)},logOut:function(){window.location.href=o.getLogoutURL("statuspage")+"sessiontimeout",r()},timeOut:function(){var t=o.getLogoutURL("statuspage")+"sessiontimeout",e=-1===t.indexOf("?")?"?":"&";window.location.href=t+e+"p_error_code=SSO-1"},hideModal:a}}]),angular.module("SSO.statuspage",["ui.router","SSO.url"]).config(function(t,e){t.state("status",{url:"/",views:{header:{templateUrl:"templates/header.html"},content:{templateUrl:"templates/status-page.tmpl.html"},footer:{templateUrl:"templates/footer.html"}},onEnter:function(t){t.document.title="Error | Worldpay Account"}}).state("status.setupsuccessEmail",{views:{"content@":{templateUrl:"templates/ssEmail.tmpl.html"}},params:{statusmsg:""},onEnter:function(t){t.document.title="Update your account | Worldpay Account"}}),e.otherwise(function(t,e){t.invoke(["$state",function(t){t.go("status")}])})}),angular.module("SSO.statuspage").service("statusService",["$http","$q",function(t,e){return{loadStatusConfig:function(){return t.get("configs/statusconfig.json")}}}]);(app=angular.module("SSO.statuspage")).controller("statusController",["$scope","$sce","$stateParams","$state","statusService",function(t,e,n,o,s){t.queryParams={},t.statusTitle="Oops. Something went wrong",t.statusInfo="An error occurred whilst processing your request. Please refresh the page or try again later.",t.errors=[],t.status=document.location.href,function(){window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,n,o){t.queryParams[n]=o});t.queryParams}(),t.status=t.queryParams.status_code,t.useremail=t.queryParams.useremail,t.defaultURL="http://www.worldpay.com",t.useremail&&(t.useremail=decodeURIComponent(t.useremail),t.useremail.includes("#!/")&&(t.useremail=t.useremail.slice(0,-3)),o.go("status.setupsuccessEmail")),s.loadStatusConfig().then(function(t){this.statuses=t.data,this.defaultURL=t.data[0].defaultURL,this.status||(this.status=""),this.statusInfo=this.statuses[this.statuses.map(t=>t.status).indexOf(this.status.toString())],this.statusInfo||(this.statusInfo=this.statuses[1]),this.statusInfo.statusMsg=e.trustAsHtml(this.statusInfo.statusMsg)}.bind(t),function(t){console.log(t.statusText)}),t.ok=function(){t.queryParams.redirectURL?window.location.href=t.queryParams.redirectURL:window.location.href=t.defaultURL,console.log("ok")}}]),angular.module("SSO.securityquestions").factory("SQService",["$http","$q","urlService",function(t,e,n){e.defer();var o=$(".scm").attr("class").split(" ")[1];return{getSecurityQuestions:function(e,s){return t.get(n.getURL(o+"SQ"),{headers:{directive:e,backUrl:s}})},loadSQConfig:function(){return t.get(n.getURL("SQconfig"))},postAnswers:function(e,s){return t.post(n.getURL(o+"SQpost"),e,{headers:{"X-CSRF-CUSTOM-TOKEN":"SomeRandomValue",backUrl:s}})},mockPostAnswers:function(e){return t.post("views/security-questions/configs/postSQAPIresponse.json")}}}]);(app=angular.module("SSO.securityquestions")).controller("SQController",["$scope","$stateParams","$state","SQService","urlService","idleService",function(t,e,n,o,s,i){t.questions=[],t.userEmail="someemail";o.getSecurityQuestions({},s.getBackURL()).then(function(e){i.startTimer(),t.userEmail=e.data.userName,t.questions=e.data.securityQuestions,t.originalQuestions=jQuery.extend(!0,[],t.questions),0==t.questions.length||"NOSQ"===t.questions.directive?window.location.href=e.data.nextLink:l()},function(t){window.location.href=s.getLogoutURL("statuspage")+"noSQinfo"}),o.loadSQConfig().then(function(e){i.startTimer();var n=e.data;t.midConfig=n[n.map(t=>t.questionType).indexOf("MID")],t.postcodeConfig=n[n.map(t=>t.questionType).indexOf("POSTCODE")],t.contactConfig=n[n.map(t=>t.questionType).indexOf("LASTNAME")]}),t.onKeyUp=function(e){txtElem="#txtAnswer"+e,incElem="#pIncorrect"+e,$(txtElem).attr("class").includes("MID")&&$(txtElem).val().length>=t.midConfig.minFieldLength?r(txtElem,incElem):$(txtElem).attr("class").includes("POSTCODE")&&$(txtElem).val().length>=t.postcodeConfig.minFieldLength?r(txtElem,incElem):$(txtElem).attr("class").includes("LASTNAME")&&$(txtElem).val().length>t.contactConfig.minFieldLength&&r(txtElem,incElem),"POSTCODE"!=this.questions[e-1].questionType&&"LASTNAME"!=this.questions[e-1].questionType||$(txtElem).val($(txtElem).val().toUpperCase()),u()},t.validateInput=function(e,n){var o=new RegExp;switch(e){case"MID":o=new RegExp(t.midConfig.validRegex);break;case"POSTCODE":o=new RegExp(t.postcodeConfig.validRegex);break;case"LASTNAME":o=new RegExp(t.contactConfig.validRegex)}var s=n||window.event,i=s.keyCode||s.which;8!=i&&(i=String.fromCharCode(i),o.test(i)||(s.returnValue=!1,s.preventDefault&&s.preventDefault()))},t.expand=function(t){t="#"+t,"none"==$(t).css("display")?$(t).css("display","block"):$(t).css("display","none")},t.expandHint=function(e){t.expand(e),iconhintindex="#icon"+e,$(iconhintindex).find("i").toggleClass("glyphicon-question-sign").toggleClass("glyphicon-minus-sign")},t.reloadSQ=function(e){t.questions=e},t.submitForm=function(){var e={};this.questions=jQuery.extend(!0,[],this.originalQuestions);for(var n=0;n<this.originalQuestions.length;n++)ansElem="#txtAnswer"+(n+1),this.questions[n].answer+=$(ansElem).val();$(".content").css("display","none"),$(".loadingAnimation").css("display","block"),e.securityQuestions=this.questions,o.postAnswers(e,s.getBackURL()).then(function(t){if(i.startTimer(),1!=t.data.disabled){if(!(t.data.securityQuestions.length>0))return!0,void(window.location.href=t.data.nextLink);this.reloadSQ(t.data.securityQuestions),!1;for(var e=0;e<this.questions.length;e++)switch(this.questions[e].questionType){case"MID":a("MID");break;case"POSTCODE":a("POSTCODE");break;case"LASTNAME":a("LASTNAME");break;default:console.log("no further questions found")}u(),l()}else window.location.href=s.getLogoutURL("statuspage")+"accountdisabled"}.bind(t),function(t){i.startTimer(),!1,window.location.href=s.getLogoutURL("statuspage")+t.status})};function a(e){for(var n=1;n<=t.originalQuestions.length;n++){var o="#txtAnswer"+n,s="#pIncorrect"+n;if($(o).attr("class").includes(e)){$(o).val(""),$(o).css("border-color","red"),$(s).css("display","block");break}}}function r(t,e){$(e).css("display","none"),$(t).css("border-color","#ccc")}function u(){for(var e=!1,n=!0,o=1;o<=t.questions.length;o++){var s="#txtAnswer"+o;e=n=!($(s).attr("class").includes("LASTNAME")&&$(s).val().length>t.contactConfig.minFieldLength&&!e)&&(!($(s).attr("class").includes("POSTCODE")&&$(s).val().length>=t.postcodeConfig.minFieldLength&&!e)&&!($(s).val().length>=t.midConfig.minFieldLength&&!e))}n?$("#btnSubmitSQ").prop("disabled",!0):$("#btnSubmitSQ").attr("disabled",!1)}function l(){$(".content").css("display","block"),$(".loadingAnimation").css("display","none")}document.addEventListener("invalid",function(t){t.preventDefault()},!0)}]);(app=angular.module("SSO.securityquestions")).controller("accDisabledController",["$scope","$stateParams","$state","urlService",function(t,e,n,o){t.validateInput=function(){document.location.href=o.getLogoutURL()}}]);